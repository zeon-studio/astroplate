---
import { humanize } from "@/lib/utils/textConverter";

const { className }: { className?: string } = Astro.props;

// 1. è·å–å¹¶è¿‡æ»¤æ‰ç©ºå­—ç¬¦ä¸²
const paths = Astro.url.pathname.split("/").filter((x) => x);
let parts = [
  {
    label: "é¦–é¡µ", // å§‹ç»ˆæ˜¾ç¤ºä¸­æ–‡
    href: "/",
    "aria-label": Astro.url.pathname === "/" ? "é¡µ" : undefined,
  },
];

for (let i = 0; i < paths.length; i++) {
  const segment = paths[i];
  const previousSegment = i > 0 ? paths[i - 1] : null;

  // ğŸŒŸ æ ¸å¿ƒä¿®å¤ 1ï¼šè·³è¿‡ "page" æ®µï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ä¸ªå¾ªç¯å¤„ç†é¡µç 
  if (segment === "page") continue;
  
  // ğŸŒŸ æ ¸å¿ƒä¿®å¤ 2ï¼šå¦‚æœå½“å‰æ®µæ˜¯æ•°å­—ä¸”å‰é¢æ˜¯ "page"ï¼Œåˆ™è·³è¿‡ï¼ˆå› ä¸ºå®ƒè¢«å½“åšä¸Šä¸€ä¸ªæ®µçš„é¡µç ï¼‰
  if (previousSegment === "page" && !isNaN(Number(segment))) continue;

  const href = `/${paths.slice(0, i + 1).join("/")}`;
  
  // æ ¸å¿ƒä¿®å¤ 3ï¼šåœ¨å¤„ç†ä¹‹å‰ï¼Œå¯¹ URL ç¼–ç çš„æ®µè¿›è¡Œè§£ç 
  const decodedSegment = decodeURIComponent(segment);

  let displayLabel = decodedSegment.replace(".html", "").replace(/[-_]/g, " ");

  // ğŸŒŸ æ ¸å¿ƒä¿®å¤ 4ï¼šå¤„ç†ç‰¹å®šçš„è‹±æ–‡è·¯å¾„ï¼Œè¿›è¡Œä¸­æ–‡åŒ–
  const lowerCaseLabel = displayLabel.toLowerCase();

  if (lowerCaseLabel === "blog") {
    displayLabel = "åšå®¢";
  } else if (lowerCaseLabel === "tags") {
    displayLabel = "æ ‡ç­¾";
  } else if (lowerCaseLabel === "category" || lowerCaseLabel === "categories") { // ğŸš€ å…³é”®ä¿®å¤ï¼šæ·»åŠ å¯¹ categories çš„åˆ¤æ–­
    displayLabel = "åˆ†ç±»";
  } 
  
  // ğŸŒŸ æ ¸å¿ƒä¿®å¤ 5ï¼šå¤„ç†é¡µç æ˜¾ç¤º (ä¾‹å¦‚ï¼š/blog/page/2)
  else if (previousSegment === "page" && !isNaN(Number(segment))) {
    displayLabel = `ç¬¬ ${segment} é¡µ`;
  }
  else {
    // å¯¹è§£ç åçš„æ®µè¿è¡Œ humanize è¿›è¡Œç¾åŒ– (å¦‚ 'ren-xiang' -> 'Ren Xiang')
    displayLabel = humanize(displayLabel);
  }
  
  // é¿å…æ·»åŠ ç©ºæ ‡ç­¾
  if (displayLabel) {
    parts.push({
      label: displayLabel,
      href,
      "aria-label": Astro.url.pathname === href ? "é¡µ" : undefined,
    });
  }
}
---

<nav aria-label="Breadcrumb" class={className}>
  <ol class="inline-flex" role="list">
    {
      parts.map(({ label, ...attrs }, index) => (
        <li class="mx-1 capitalize" role="listitem">
          {index > 0 && <span class="inlin-block mr-1">/</span>}
          {index !== parts.length - 1 ? (
            <a class="text-primary dark:text-darkmode-primary" {...attrs}>
              {label}
            </a>
          ) : (
            <span class="text-text-light dark:text-darkmode-text-light">
              {label}
            </span>
          )}
        </li>
      ))
    }
  </ol>
</nav>
